wd <- "C:/Users/alejandro.vaqueiro/OneDrive - Cognodata consulting/Proyectos/Correos/Modelo de fugas/Presentaciones"
rutaLogo1 <-  'Logo-medio_Cognodata.png'
rutaLogo2 <- '1200px-Logo_Correos_2019.svg.png'
rutaExcel1 <- "gestores.xlsx"
rutaExcel2 <- "cnae.xlsx"
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:65px;width:130px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:130;  padding:10px;height:200px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:10px;height:200px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:10px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:65px;width:130px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:100px;width:200px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:50px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:25;  padding:10px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:-100;  padding:10px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:10px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:5px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:50px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:5px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:10px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:0px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:0px;margin:10px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:0px;margin:500px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:0px;margin:50px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:140;  padding:0px;margin:50px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:0px;margin:50px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; top:0; right:0;  padding:0px;margin:150px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; top:0; right:0;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; top:0; right:0;  padding:0px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; top:0; right:450;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; top:0; right:50;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; top:0; right:-50;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; top:0; right:-400;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; top:0; right:-450;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; top:0; right:-350;  padding:0px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; top:0; right:0;  padding:0px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; left:150;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; left:0;  padding:0px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; left:450;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; left:50;  padding:0px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; left:50
;  padding:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; left:50
;  padding:0px;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; left:50
;  padding:0px;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; left:450;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative; left:50
;  padding:0px;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative; left:450;  padding:0px;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0
;padding:0px;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0
;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; left:0;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0
;margin:100px;height:75px;width:75px')
wd <- "C:/Users/alejandro.vaqueiro/OneDrive - Cognodata consulting/Proyectos/Correos/Modelo de fugas/Presentaciones"
rutaLogo1 <-  'Logo-medio_Cognodata.png'
rutaLogo2 <- '1200px-Logo_Correos_2019.svg.png'
rutaExcel1 <- "gestores.xlsx"
rutaExcel2 <- "cnae.xlsx"
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; right:0;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; right:0;top:50;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0;
top:120
;margin:100px;height:75px;width:75px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0;
top:120
;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0;
top:0
;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute; right:50;top:50;height:70px;width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0;
top:100
;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0;
bot:100
;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0;
top:25
;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute; right:0;
top:0
;margin:100px;height:100px;width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute;
right:50;
top:50;
height:70px;
width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute;
right:50;
top:50;
height:70px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute;
right:50;
top:50;
height:70px;
width:1400px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute;
right:50;
top:50;
height:70px;
width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute;
right:0;
top:0;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute;
right:50;
top:0;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute;
right:150;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute;
left:150;
top:50;
margin:50px;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute;
left:50;
top:50;
padding:50px;
height:70px;
width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute;
left:150;
top:50;
padding:50px;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:relative;
left:50;
top:50;
height:70px;
width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative;
left:150;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative;
left:200;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:relative;
left:300;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
alt = 'logo',
style = 'position:absolute;
left:1000;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
style = 'position:absolute;
left:1000;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
style = 'position:absolute;
left:50;
top:50;
height:70px;
width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
style = 'position:fixed;
left:1000;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
style = 'position:fixed;
left:50;
top:50;
height:70px;
width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
style = 'position:fixed;
left:1000;
top:50;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
style = 'position:fixed;
height:70px;
width:140px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
style = 'position:fixed;
height:100px;
width:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
style = 'position:relative;
height:100px;
width:100px;
padding:100px')
htmltools::img(src = knitr::image_uri(rutaLogo2),
style = 'position:relative;
height:100px;
width:100px;
margin:100px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = logo
style = 'position:absolute;
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = logo,
style = 'position:absolute;
top:0px;
right:0px;
height:70px;
width:140px;
padding:10px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute;
top:0px;
right:0px;
height:70px;
width:140px;
padding:10px')
htmltools::img(src = knitr::image_uri(rutaLogo1),
alt = 'logo',
style = 'position:absolute;
top:0px;
right:0px;
height:120px;
width:240px;
padding:10px')
install.packages("ggrepel")
setwd("GitHub/iowa_houses/")
train <- read.csv("train.csv", stringsAsFactors = F, na.strings = "NA")
test <- read.csv("test.csv", stringsAsFactors = F, na.strings = "NA")
#### EDA ####
test.id <- test$Id
test$Id <- NULL
train$Id <- NULL
test$SalePrice <- NA
df <- rbind(train, test)
ggplot(train, aes(x = SalePrice)) +
geom_histogram(fill = "blue", binwidth = 1e4) +
scale_x_continuous(breaks = seq(0,8e5, by = 1e5), labels = comma)
numeric.vars <- names(which(sapply(train, is.numeric)))
df.numvars <- train[ ,numeric.vars]
cor.numvars <- cor(df.numvars, use = "pairwise.complete.obs")
cor.target <- as.matrix(sort(cor.numvars[ ,"SalePrice"], decreasing = T))
highcor <- names(which(apply(cor.target, 1, function(x) abs(x) > 0.5)))
cor.numvars <- cor.numvars[highcor, highcor]
corrplot.mixed(cor.numvars, tl.col = "black", tl.pos = "lt")
ggplot(train, aes(x = factor(OverallQual), y = SalePrice)) +
geom_boxplot(col = "blue") +
labs(x = "Overall quality") +
scale_y_continuous(breaks = seq(0, 8e5, by = 1e5), labels = comma)
ggplot(train, aes(x = GrLivArea, y = SalePrice)) +
geom_point(col = "blue") +
geom_smooth(method = "lm", se = T, color = "black", aes(group = 1)) +
scale_y_continuous(breaks= seq(0, 8e5, by= 1e5), labels = comma) +
geom_text_repel(aes(label = ifelse(train$GrLivArea[!is.na(train$SalePrice)]>4500, rownames(train), '')))
#### Missing values ####
na.cols <- which(colSums(is.na(df)) > 0)
sort(colSums(sapply(df[na.cols], is.na)), decreasing = T)
#### Na imputing ####
library(plyr)
library(dplyr)
df$PoolQC[is.na(df$PoolQC)] <- "None"
Qualities <- c('None' = 0, 'Po' = 1, 'Fa' = 2, 'TA' = 3, 'Gd' = 4, 'Ex' = 5)
df$PoolQC <- as.integer(revalue(df$PoolQC, Qualities))
df[df$PoolArea > 0 & df$PoolQC == 0, c('PoolArea', 'PoolQC', 'OverallQual')]
df$PoolQC[2421] <- 2
df$PoolQC[2504] <- 2
df$PoolQC[2600] <- 3
df$MiscFeature[is.na(df$MiscFeature)] <- "None"
df$MiscFeature <- as.factor(df$ MiscFeature)
df$Alley[is.na(df$Alley)] <- "None"
df$Alley <- as.factor(df$Alley)
df$Fence[is.na(df$Fence)] <- "None"
df[!is.na(df$SalePrice), ] %>%
group_by(Fence) %>%
summarise(median = median(SalePrice), counts = n())
df$Fence <- as.factor(df$Fence)
df$FireplaceQu[is.na(df$FireplaceQu)] <- "None"
df$FireplaceQu <- as.integer(revalue(df$FireplaceQu, Qualities))
ggplot(df, aes(x = as.factor(Neighborhood), y = LotFrontage)) +
geom_bar(stat = "summary", fun.y = "median", fill = "blue") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
for (i in 1:nrow(df)){
if (is.na(df$LotFrontage[i])) {
df$LotFrontage[i] <- as.integer(median(df$LotFrontage[df$Neighborhood == df[i, "Neighborhood"]], na.rm = T))
}
}
df$LotShape <- as.integer(revalue(df$LotShape, c("IR3" = 0, "IR2" = 1, "IR1" = 2, "Reg" = 3)))
library(ggplot2)
library(corrplot)
library(ggrepel)
#### EDA ####
test.id <- test$Id
test$Id <- NULL
train$Id <- NULL
test$SalePrice <- NA
df <- rbind(train, test)
ggplot(train, aes(x = SalePrice)) +
geom_histogram(fill = "blue", binwidth = 1e4) +
scale_x_continuous(breaks = seq(0,8e5, by = 1e5), labels = comma)
numeric.vars <- names(which(sapply(train, is.numeric)))
df.numvars <- train[ ,numeric.vars]
cor.numvars <- cor(df.numvars, use = "pairwise.complete.obs")
cor.target <- as.matrix(sort(cor.numvars[ ,"SalePrice"], decreasing = T))
highcor <- names(which(apply(cor.target, 1, function(x) abs(x) > 0.5)))
cor.numvars <- cor.numvars[highcor, highcor]
corrplot.mixed(cor.numvars, tl.col = "black", tl.pos = "lt")
ggplot(train, aes(x = factor(OverallQual), y = SalePrice)) +
geom_boxplot(col = "blue") +
labs(x = "Overall quality") +
scale_y_continuous(breaks = seq(0, 8e5, by = 1e5), labels = comma)
ggplot(train, aes(x = GrLivArea, y = SalePrice)) +
geom_point(col = "blue") +
geom_smooth(method = "lm", se = T, color = "black", aes(group = 1)) +
scale_y_continuous(breaks= seq(0, 8e5, by= 1e5), labels = comma) +
geom_text_repel(aes(label = ifelse(train$GrLivArea[!is.na(train$SalePrice)]>4500, rownames(train), '')))
#### Missing values ####
na.cols <- which(colSums(is.na(df)) > 0)
sort(colSums(sapply(df[na.cols], is.na)), decreasing = T)
#### Na imputing ####
library(plyr)
library(dplyr)
df$PoolQC[is.na(df$PoolQC)] <- "None"
Qualities <- c('None' = 0, 'Po' = 1, 'Fa' = 2, 'TA' = 3, 'Gd' = 4, 'Ex' = 5)
df$PoolQC <- as.integer(revalue(df$PoolQC, Qualities))
df[df$PoolArea > 0 & df$PoolQC == 0, c('PoolArea', 'PoolQC', 'OverallQual')]
df$PoolQC[2421] <- 2
df$PoolQC[2504] <- 2
df$PoolQC[2600] <- 3
df$MiscFeature[is.na(df$MiscFeature)] <- "None"
df$MiscFeature <- as.factor(df$ MiscFeature)
df$Alley[is.na(df$Alley)] <- "None"
df$Alley <- as.factor(df$Alley)
df$Fence[is.na(df$Fence)] <- "None"
df[!is.na(df$SalePrice), ] %>%
group_by(Fence) %>%
summarise(median = median(SalePrice), counts = n())
df$Fence <- as.factor(df$Fence)
df$FireplaceQu[is.na(df$FireplaceQu)] <- "None"
df$FireplaceQu <- as.integer(revalue(df$FireplaceQu, Qualities))
ggplot(df, aes(x = as.factor(Neighborhood), y = LotFrontage)) +
geom_bar(stat = "summary", fun.y = "median", fill = "blue") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
for (i in 1:nrow(df)){
if (is.na(df$LotFrontage[i])) {
df$LotFrontage[i] <- as.integer(median(df$LotFrontage[df$Neighborhood == df[i, "Neighborhood"]], na.rm = T))
}
}
df$LotShape <- as.integer(revalue(df$LotShape, c("IR3" = 0, "IR2" = 1, "IR1" = 2, "Reg" = 3)))
df$LotConfig <- as.factor(df$LotConfig)
